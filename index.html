<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Singapore Population Choropleth Map</title>
    <style>
        /* General Styles */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background: #f9f9f9;
            color: #333;
        }

        h1 {
            text-align: center;
            margin: 20px 0;
            color: #444;
        }

        #map {
            width: 90%;
            height: 600px;
            margin: 20px auto;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .tooltip {
            position: absolute;
            background: rgba(50, 50, 50, 0.85);
            color: #fff;
            padding: 8px 12px;
            font-size: 14px;
            border-radius: 4px;
            pointer-events: none;
            visibility: hidden;
            white-space: nowrap;
            box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .legend-container {
            text-align: center;
            margin: 20px 0;
        }

        .legend {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 10px;
        }

        .legend-scale {
            height: 20px;
            width: 300px;
            background: linear-gradient(to right, #e3f2fd, #42a5f5);
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .legend-label {
            font-size: 12px;
            color: #555;
            margin: 0 8px;
        }

        /* Map Responsiveness */
        @media (max-width: 768px) {
            #map {
                height: 400px;
            }

            .legend-scale {
                width: 200px;
            }
        }
    </style>
</head>
<body>
    <h1>Singapore Population Choropleth Map</h1>
    <div id="map"></div>
    <div class="legend-container">
        <div class="legend">
            <span class="legend-label">Low</span>
            <div class="legend-scale"></div>
            <span class="legend-label">High</span>
        </div>
    </div>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
        const width = 800, height = 600;

        // SVG container
        const svg = d3.select("#map")
            .append("svg")
            .attr("viewBox", `0 0 ${width} ${height}`)
            .attr("preserveAspectRatio", "xMidYMid meet");

        // Tooltip
        const tooltip = d3.select("body").append("div")
            .attr("class", "tooltip");

        // Load GeoJSON and population data
        Promise.all([
            d3.json("data/sgmap.json"),  // GeoJSON data
            d3.csv("data/population2023.csv") // Population data
        ]).then(([geoData, populationData]) => {
            // Create a mapping of region names to population
            const populationMap = new Map();
            populationData.forEach(d => {
                populationMap.set(d.region, +d.population);
            });

            // Define color scale
            const maxPopulation = d3.max([...populationMap.values()]);
            const colorScale = d3.scaleSequential()
                .domain([0, maxPopulation])
                .interpolator(d3.interpolateBlues);

            // Map projection and path
            const projection = d3.geoMercator().fitSize([width, height], geoData);
            const path = d3.geoPath().projection(projection);

            // Draw regions
            svg.selectAll("path")
                .data(geoData.features)
                .enter()
                .append("path")
                .attr("d", path)
                .attr("fill", d => {
                    const region = d.properties.Name;
                    const population = populationMap.get(region) || 0;
                    return colorScale(population);
                })
                .attr("stroke", "#fff")
                .attr("stroke-width", 1.5)
                .on("mouseover", (event, d) => {
                    const region = d.properties.Name;
                    const population = populationMap.get(region) || "No data";
                    tooltip.style("visibility", "visible")
                        .text(`${region}: ${typeof population === "number" ? population.toLocaleString() : population}`);
                })
                .on("mousemove", event => {
                    tooltip.style("top", `${event.pageY + 10}px`)
                        .style("left", `${event.pageX + 10}px`);
                })
                .on("mouseout", () => {
                    tooltip.style("visibility", "hidden");
                });

            // Update legend dynamically
            d3.select(".legend-scale")
                .style("background", `linear-gradient(to right, ${colorScale(0)}, ${colorScale(maxPopulation)})`);
        });
    </script>
</body>
</html>
